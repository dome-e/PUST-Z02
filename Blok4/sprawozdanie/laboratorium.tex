% !TEX encoding = cp1250
\chapter{Æwiczenie laboratoryjne}

Podczas tego zadania laboratoryjnego wykorzystano:
\begin{itemize}
	\item grza³ki G1 i G2 (sygna³ steruj¹cy $U$),
	\item wentylatory W1 i W2 (wartoœæ zadana $Y_{zad}$),
	\item czujniki temperatury T1 i T3 (sygna³ wyjœciowy $Y$) 
\end{itemize} 

\section{Przygotowanie do wykonania æwiczenia}
Przed rozpoczêciem pomiarów sprawdzono mo¿liwoœæ sterowania i~pomiaru w~komunikacji ze stanowiskiem. Punkty pracy grza³ek $G1$ i $G2$ dla zespo³u obliczone zosta³y wg. wzoru \ref{w_G1}:
\begin{equation}
	G1 = 25 + Z\
	G2 = 30 + Z\
\label{w_G1}
\end{equation}
gdzie Z~to numer zespo³u \%5, zatem dla grupy Z02 punkt pracy  wynosi:
\begin{equation}
	G1 = 25 + 2\%5 = 25 + 2 = 27\
	G2 = 30 + 2\%5 = 30 + 2 = 32\
\end{equation}
Nastêpnie okreœlono wartoœci pomiarów temperatur T1 i T3 dla obliczonych punktów pracy. W~tym celu moc wentylatorów W1 i W2 ustawiono na 50\% za pomoc¹ rejestrów:

\begin{lstlisting}[style=customlatex,frame=single] 
	D110 := 500;  // W1
	D111 := 500;  // W2
\end{lstlisting}

Moc wentylatorów, zarówno jak i grza³ek przesy³ana jest w postaci wartoœci 10 razy wiêkszych ni¿ oczekiwane (np. 50\% reprezentowane jest przez wartoœæ 500). Odczytywana temperatura jest za to pomno¿ona razy 100 (np. 25$\degreeC reprezentowane jest przez wartoœæ 2500)

Wartoœci mocy grza³ki zadawane s¹ poprzez rejestry: 
\begin{lstlisting}[style=customlatex,frame=single] 
	D114 := 270;  // G1
	D115 := 320;  // G2
\end{lstlisting}

Wartoœæ G1 zosta³a ustawiona na 27\%, a G2 na wartoœæ 32\%.

Temperatury T1 i T3 odczytano korzystaj¹c odpowiednio z~rejestrów 
\begin{lstlisting}[style=customlatex,frame=single] 
	T_1 := D100;
	T_3 := D102;
\end{lstlisting}

Przy $G1 = 27$ i $G2 = 32$ temperatura T1 ustabilizowa³a siê na wartoœci \textbf{20,37\degree C}, a temperatura T3 na wartoœci \textbf{21,00 \degree C}

\section{ Mechanizm zabezpieczaj¹cy przed uszkodzeniem}
 Zaimplementowane zosta³o zabezpieczenie przed uszkodzeniem stanowiska w przypadku uszkodzenia czujnika temperatury. Sytuacja taka mo¿e doprowadziæ do wzrostu temperatury stanowiska do niebezpiecznego stopnia, zatem, gdy czujnik wska¿e temperaturê przekraczaj¹c¹ 250 \degree C, grza³ka znajduj¹ca siê przy tym czujniku zostaje wy³¹czona. Implementacja zabezpieczenia znajduje siê poni¿ej. Uwzglêdnia ona równie¿ ograniczenia sterowania grza³kami (minimalnie 0\% i maksymalnie 100\% mocy).
 
\begin{lstlisting}[style=customlatex,frame=single] 
IF (T_1 > 25000.0) THEN
	U1_PID1 := 0;
	ELSIF(U1_PID1 > 1000) THEN
	U1_PID1 := 1000;
	ELSIF(U1_PID1 < 1) THEN
	U1_PID1 := 0;
END_IF;
\end{lstlisting}

\begin{lstlisting}[style=customlatex,frame=single] 
F (T_3 > 25000.0) THEN
	U1_PID2 := 0;
	ELSIF(U1_PID2 > 1000) THEN
	U1_PID2 := 1000;
	ELSIF(U1_PID2 < 1) THEN
	U1_PID2 := 0;
END_IF;
\end{lstlisting}

\section{Regulator dwupêtlowy PID}
Do realizacji zadania wykorzystano podstawowy plik do komunikacji ze stanowiskiem grzej¹co - ch³odz¹cym \texttt{PUST\_PLC.gx3}.
\newline
Zarejestrowano przebieg temperatury T1 dla trzech ró¿nych zmian wartoœci sterowania G1, rozpoczynaj¹c z punktu pracy 27 do kolejno 20, 40, 60 i~80.
Otrzymane przebiegi zmian przedstawiono na Rys. \ref{rys_zad2pomiary}. 




\section{Regulator PID z laboratorium 1}
Nastêpnie przetestowano regulatory z laboratorium 1, w celu porównania ich zaimplementowanymi póŸniej regulatorami rozmytymi. Testy przeprowadzone zosta³y dla trajektorii zmian sygna³u zadanego $y_{zad}$: $T_{pp}, T_{pp} + 5, T_{pp} + 15, T_{pp}$. Dla wartoœci punktu pracy $T_{pp}~=~T1~=~31,81$ zmiany te wynosi³y kolejno: $y_{zad}=31,81, y_{zad}=36,81, y_{zad}=46,81,y_{zad}= 31,81$.
Przebiegi przedstawione zosta³y na Rys.~\ref{rys_PID_lab1}. Implementacja algorytmu dla regulatora PID znajduje siê w pliku \texttt{zad3\_PID.mat}.

%\begin{figure}[H]
%	\centering
%	\includegraphics[scale=0.2]{png/lab/zad3_PID_test_wlasciwy_zoomed.png}
%	\caption{OdpowiedŸ uk³adu przy regulacji regulatorem PID z laboratorium 1}
%	\label{rys_PID_lab1}
%\end{figure}

WskaŸnik jakoœci wyniós³ $E= 24241$

\section{Regulator DMC z laboratorium 1}
Analogicznie przetestowany zosta³ regulator DMC z laboratorium 1. Testy przeprowadzono dla tej samej trajektorii zmian sygna³u zadanego. Przebiegi widoczne sa na Rys.~\ref{rys_DMC_lab1}. Implementacja algorytmu dla regulatora DMC znajduje siê w pliku \texttt{zad3\_DMC.mat}.

%\begin{figure}[H]
%	\centering
%	\includegraphics[scale=0.2]{png/lab/zad3_DMC_test.png}
%	\caption{OdpowiedŸ uk³adu przy regulacji regulatorem DMC z laboratorium 1}
%	\label{rys_DMC_lab1}
%\end{figure}

Wartoœæ wskaŸnika jakoœci regulacji wynios³a $E=19511$

\section{Rozmyty algorytm PID}

Zespó³ nie zd¹¿y³ zaimplementowaæ algorytmu realizuj¹cego regulacjê PID w czasie trwania laboratorium. 

Jeœli dostêpne by³oby wiêcej czasu, algorytm rozmytego regulatora PID zaimplementowany zosta³by analogicznie do rozmytego regulatora PID z czêœci projektowej.
Dla ka¿dego z trzech regulatorów lokalnych zosta³yby dobrane oddzielne nastawy metod¹ eksperymentaln¹, tak by zapewniæ najlepsz¹ jakoœæ regulacji. Do wyliczenia wspó³czynników przynale¿noœci ka¿dego z regulatorów u¿yta zosta³aby funkcja przynale¿noœci dzwonowej \texttt{gbellmf}.

\section{Rozmyty algorytm DMC}

Zaimplementowany zosta³ algorytm rozmytego regulatora DMC.

Rozpoczêto od wyznaczenia zestawów liczb $s_1, s_2, s_3, ...$ dla ka¿dego z trzech regulatorów. Zestawy te wyznaczone zosta³y poprzez przekszta³cenie odpowiedzi skokowych dla wartoœci sterowania $u = 20$, $u = 40$ i $u = 80$ przedstawionych na Rys. \ref{rys_zad2pomiary}. Przekszta³cenie to przebieg³o zgodnie ze wzorem \ref{w_Si}.

\begin{equation}
	S_i = \frac{S_i^0  - Y_{pp}}{\Delta U}, i = 1, 2, 3,  ...
	\label{w_Si}
\end{equation}

Z przebiegów nieprzekszta³conej odpowiedzi skokowej odczytano pierwsze i ostatnie skoki sygna³u wyjœciowego, które wykorzystano do obliczenia horyzontu dynamiki $D$. Wszelkie obliczenia wykonane zosta³y w programie MATLAB w pliku \texttt{zad4\_s.m}.

Otrzymano zatem trzy zestawy liczb $s_1, s_2, s_3, ...$, oraz trzy wartoœci horyzontów dynamiki $D$ - po jednym na ka¿dy z regulatorów: $D_1 = 252$, $D_2 = 289$, $D_3 = 276$ .

Wartoœci te wykorzystane zosta³y do obliczeñ w algorytmie DMC. Macierze $M$, $M^P$ i $K$ obliczone zosta³y oddzielnie dla ka¿dego z regulatorów. 
Nastêpnie wyliczono wagi (wspó³czynniki przynale¿noœci) dla ka¿dego z regulatorów, korzystaj¹c z funkcji przynale¿noœci dzwonowej \texttt{gbellmf} w programie MATLAB. U¿yte w naszym algorytmie funkcje przynale¿noœci przedstawione zosta³y na Rys. \ref{rys_dzwony}

%\begin{figure}[H]
%	\centering
%	\includegraphics[scale=0.25]{png/lab/gbell.png}
%	\caption{Funkcje przynale¿noœci}
%	\label{rys_dzwony}
%\end{figure}

Wartoœæ sygna³u sterowania zosta³a wyliczona oddzielnie dla ka¿dego z regulatorów zgodnie ze wzorem \ref{w_uR}.

\begin{equation}
	u^R(k)=K^R(Y^{zad}(k) -Y(k)-M^{P,r} \Delta u^P(k))
	\label{w_uR}
\end{equation}

je¿eli $u(k-1) \in U_2$, 

i gdzie R to numer regulatora

Poszczególne wartoœci sygna³u sterowania $u^R(k)$ dla ka¿dego z regulatorów wykorzystane zosta³y do obliczenia ca³oœciowej wartoœci $u(k)$ wed³ug wzoru \ref{w_uk}.

\begin{equation}
	u(k)=\frac{\sum w^i(k)u^i(k)}{\sum w^i(k)}
	\label{w_uk}
\end{equation}

Implementacja algorytmu znajduje siê w pliku \texttt{zad4\_1.m}


Horyzont sterowania $D$ dla regulatora DMC zosta³ dobrany poprzez wybranie najwiêkszego z obliczonych wy¿ej horyzontów dynamiki dla ka¿dego z regulatorów. W tym przypadku jego wartoœæ wynosi $D=289$. Zgodnie z treœci¹ zadania laboratoryjnego pozosta³e parametrom regulatora przypisano wartoœci $N_u = N = D = 289$ i $\lambda=1$. 

Regulator przetestowano dla tej samej trajektorii co regulatory z laboratorium 1: $y_{zad}$: $T_{pp}, T_{pp} + 5, T_{pp} + 15, T_{pp}$. Wyniki przedstawione zosta³y na Rys. \ref{rys_DMC_rozmyty}

%\begin{figure}[H]
%	\centering
%	\includegraphics[scale=0.23]{png/lab/DMC_rozmyty.png}
%	\caption{Przebiegi dla regulatora rozmytego DMC}
%	\label{rys_DMC_rozmyty}
%\end{figure}

Wartoœæ wskaŸnika jakoœci regulacji wynios³a $E=15709$. Regulator rozmyty wykazuje siê zatem lepsz¹ jakoœci¹ regulacji ni¿ regulator DMC w najprostszej wersji analitycznej z laboratorium 1.